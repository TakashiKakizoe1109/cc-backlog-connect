Backlog の課題情報を `docs/backlog/` ディレクトリに同期します。

## 事前チェック

**まず `.cc-backlog/config.json` が存在するか確認してください。**

存在しない場合は、同期を実行せず以下のように案内してください:

> Backlog の接続設定がまだ行われていません。先に `/cc-backlog-connect:config` を実行して、Backlog スペース名・API キー・プロジェクトキーを設定してください。

設定が存在する場合のみ、以下の同期を実行してください。

## 実行方法

```bash
bash "${CLAUDE_PLUGIN_ROOT}/scripts/cc-backlog.sh" sync $ARGUMENTS
```

上記が失敗する場合は直接実行してください:

```bash
node "${CLAUDE_PLUGIN_ROOT}/dist/index.js" sync $ARGUMENTS
```

## $ARGUMENTS の処理

### 引数が渡された場合

ユーザーが引数を渡した場合（例: `--all`, `--issue PROJ-123` など）は、質問せずにそのままオプションとして実行してください。

### 引数がない場合（インタラクティブモード）

引数なしで呼ばれた場合は、以下の **2ステップ** でユーザーに確認してください。

---

#### Step 1: 同期範囲を選択

以下の選択肢を提示してください:

> **同期する範囲を選択してください:**
>
> 1. 未完了の課題のみ同期
> 2. 全課題を同期（完了含む）
> 3. 特定の課題を指定して同期
> 4. プレビュー（dry-run: ファイル書き込みなし）

| 選択 | $ARGUMENTS の基本部分 |
|------|----------------------|
| **1** | (引数なし) |
| **2** または **ALL** | `--all` |
| **3** または課題キー（例: `PROJ-123`） | `--issue <課題キー>` ※ 課題キーが未指定なら質問してください |
| **4** | `--dry-run` |

---

#### Step 2: フィルターを自然言語で追加（任意）

**⚠️ 重要: Step 1 の回答を受け取ったら、コマンドをまだ実行しないでください。必ず Step 2 の質問を先に行ってください。**

Step 1 の回答後、続けて以下を聞いてください:

> **フィルターを追加しますか？（Enterでスキップ）**
> 例:「田中さん担当」「バグ種別のみ」「マイルストーン3月」「高優先度」「未解決のみ」

ユーザーの自然言語入力を解釈して、以下のオプションに変換してください:

| ユーザーの表現例 | 変換するオプション |
|----------------|-----------------|
| 「〇〇さん担当」「担当者が〇〇」 | `--assignee <名前>` |
| 「バグ」「タスク」「〇〇種別」 | `--type <種別名>` |
| 「マイルストーン〇〇」「〇〇マイル」 | `--milestone <名前>` |
| 「カテゴリー〇〇」 | `--category <名前>` |
| 「〇〇で登録した」「登録者が〇〇」 | `--created-user <名前>` |
| 「ステータスが〇〇」「処理中のみ」 | `--status <名前>` |
| 「高優先度」「優先度が高い」 | `--priority 高` |
| 「〇〇バージョン」「バージョン〇〇」 | `--version <名前>` |
| 「解決済み」「修正済み」など完了理由 | `--resolution <名前>` |
| 「子課題のみ」「親課題のみ」「子課題以外」 | `--parent-child <0-4>` |
| 「〇〇を含む」「キーワード〇〇」 | `--keyword <テキスト>` |
| 「上書き」「force」 | `--force` |
| スキップ・空入力 | フィルターなし |

変換後、実行前に以下のように確認してください:

> **以下の設定で同期します:**
> - 範囲: [例: 未完了の課題のみ]
> - フィルター: [例: 担当者=田中、種別=バグ]
> - コマンド: `sync --assignee 田中 --type バグ`
>
> 実行しますか？

「はい」「OK」「実行」などの返答で実行してください。

---

**補足:**

- フィルターは複数同時に指定できます（「田中さん担当のバグ」→ `--assignee 田中 --type バグ`）
- 「上書き」「force」と言った場合は `--force` を追加してください
- `--force` はどのモードにも追加できるオプションです

## フィルタオプション（引数直接指定時の参考）

キャッシュを使った名前指定（推奨）またはID直接指定が可能です:

| オプション | 説明 |
|---------|------|
| `--status-id <ids>` | ステータスIDで絞り込み（カンマ区切り） |
| `--status <name>` | ステータス名で絞り込み（キャッシュから解決） |
| `--type-id <ids>` | 課題種別IDで絞り込み |
| `--type <name>` | 課題種別名で絞り込み（キャッシュから解決） |
| `--assignee-id <ids>` | 担当者IDで絞り込み |
| `--assignee <name>` | 担当者名で絞り込み（キャッシュから解決） |
| `--category-id <ids>` | カテゴリーIDで絞り込み |
| `--category <name>` | カテゴリー名で絞り込み（キャッシュから解決） |
| `--milestone-id <ids>` | マイルストーンIDで絞り込み |
| `--milestone <name>` | マイルストーン名で絞り込み（キャッシュから解決） |
| `--keyword <text>` | キーワードで絞り込み |
| `--version-id <ids>` | 発生バージョンIDで絞り込み |
| `--version <name>` | 発生バージョン名で絞り込み（キャッシュから解決） |
| `--priority-id <ids>` | 優先度IDで絞り込み |
| `--priority <name>` | 優先度名で絞り込み（キャッシュから解決） |
| `--created-user-id <ids>` | 登録者IDで絞り込み |
| `--created-user <name>` | 登録者名で絞り込み（キャッシュから解決） |
| `--resolution-id <ids>` | 完了理由IDで絞り込み |
| `--resolution <name>` | 完了理由名で絞り込み（キャッシュから解決） |
| `--parent-child <n>` | 親子関係で絞り込み（0=全て 1=子課題以外 2=子課題のみ 3=どちらでもない 4=親課題のみ） |
